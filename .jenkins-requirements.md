# Jenkins Pipeline Requirements

## Required Jenkins Plugins

Install the following plugins in Jenkins:

1. **Pipeline Plugin** (core)
2. **HTML Publisher Plugin** - For publishing test reports
3. **JUnit Plugin** - For test result reporting
4. **Coverage Plugin** or **Code Coverage API Plugin** - For coverage reports
5. **Email Extension Plugin** - For email notifications
6. **AnsiColor Plugin** - For colored console output (optional but recommended)

## Jenkins Agent Requirements

### Node.js Setup
```bash
# Install nvm (Node Version Manager)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc

# Install Node.js 20
nvm install 20
nvm use 20
nvm alias default 20

# Verify installation
node --version  # Should show v20.x.x
npm --version
```

### System Dependencies for Playwright
```bash
# Install Playwright system dependencies
npx playwright install-deps

# Or manually install (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y \
    libnss3 \
    libnspr4 \
    libatk1.0-0 \
    libatk-bridge2.0-0 \
    libcups2 \
    libdrm2 \
    libdbus-1-3 \
    libxkbcommon0 \
    libxcomposite1 \
    libxdamage1 \
    libxfixes3 \
    libxrandr2 \
    libgbm1 \
    libasound2
```

## Environment Variables

Set these in Jenkins (Manage Jenkins > Configure System > Global properties):

- `NODE_VERSION=20` (optional, can be set in pipeline)
- `CHANGE_AUTHOR_EMAIL` (for email notifications)

## Pipeline Configuration

1. Create a new Pipeline job in Jenkins
2. Point to the `Jenkinsfile` in your repository
3. Configure SCM (Git) with your repository URL
4. Set build triggers (polling, webhooks, etc.)

## First Run Checklist

- [ ] All required plugins installed
- [ ] Node.js 20 installed on agent
- [ ] Playwright browsers installed (`npx playwright install`)
- [ ] Repository access configured
- [ ] Email notifications configured (optional)
- [ ] Build triggers set up

## Troubleshooting

### "Node.js not found"
- Ensure Node.js is installed and in PATH
- Check nvm setup on agent
- Verify NODE_VERSION environment variable

### "Playwright browsers not found"
- Run `npx playwright install` on agent
- Check system dependencies are installed

### "Port 3000 already in use"
- Playwright should handle this, but if issues occur:
  - Kill existing processes: `lsof -ti:3000 | xargs kill -9`
  - Or change port in `playwright.config.ts`

### "Tests timeout"
- Increase timeout in `playwright.config.ts`
- Check application startup time
- Verify database is accessible

## Performance Optimization

For faster builds:
- Cache `node_modules` between builds
- Use parallel test execution (adjust workers in Playwright config)
- Consider using Docker agents for consistent environments

